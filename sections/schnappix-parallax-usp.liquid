{%- comment -%}
  SCHNAPPIX Parallax USP Section
  A unique selling points section with parallax background and 3D card effects
  Optimized for performance, accessibility, and responsive design
{%- endcomment -%}

{%- liquid
  assign section_id = 'SchnappixParallaxUSP-' | append: section.id
  assign blocks_count = section.blocks.size
  assign has_blocks = false
  assign bg_image = section.settings.bg_image
  
  if blocks_count > 0
    assign has_blocks = true
  endif
  
  assign bg_image_url = bg_image | image_url: width: 2000
  assign min_card_width = section.settings.min_card_width | default: 260
  assign grid_gap = section.settings.grid_gap | default: 40
-%}

<section
  id="{{ section_id }}"
  class="sx-parallax-usp color-{{ section.settings.color_scheme }}"
  data-section-id="{{ section.id }}"
  {% if bg_image != blank %}
    style="--bg-image-url: url({{ bg_image_url }});"
  {% endif %}
  {% if request.visual_preview_mode %}
    data-shopify-visual-preview
  {% endif %}
>
  {%- if bg_image != blank -%}
    <div class="sx-parallax-usp__background" aria-hidden="true"></div>
  {%- endif -%}
  
  {%- if section.settings.show_overlay -%}
    <div class="sx-parallax-usp__overlay" aria-hidden="true"></div>
  {%- endif -%}

  <div class="sx-parallax-usp__container section section--{{ section.settings.section_width }}">
    <div class="sx-parallax-usp__content">
      {%- if section.settings.headline != blank -%}
        <h2 class="sx-parallax-usp__headline">{{ section.settings.headline }}</h2>
      {%- endif -%}

      {%- if has_blocks -%}
        <div
          class="sx-parallax-usp__grid"
          style="
            --sx-grid-min-width: {{ min_card_width }}px;
            --sx-grid-gap: {{ grid_gap }}px;
          "
          data-usps-count="{{ blocks_count }}"
        >
          {%- for block in section.blocks -%}
            <div
              class="sx-parallax-usp__card"
              {{ block.shopify_attributes }}
              data-block-id="{{ block.id }}"
              data-usp-index="{{ forloop.index }}"
            >
              {%- if block.settings.icon != blank -%}
                <div class="sx-parallax-usp__card-icon-wrapper">
                  {{
                    block.settings.icon
                    | image_url: width: 120
                    | image_tag:
                      loading: 'lazy',
                      width: block.settings.icon.width,
                      height: block.settings.icon.height,
                      alt: block.settings.icon.alt | default: block.settings.title | escape,
                      class: 'sx-parallax-usp__card-icon'
                  }}
                </div>
              {%- endif -%}
              
              <div class="sx-parallax-usp__card-content">
                {%- if block.settings.title != blank -%}
                  <h3 class="sx-parallax-usp__card-title">{{ block.settings.title }}</h3>
                {%- endif -%}
                
                {%- if block.settings.desc != blank -%}
                  <div class="sx-parallax-usp__card-description">
                    <p>{{ block.settings.desc }}</p>
                  </div>
                {%- endif -%}
              </div>
            </div>
          {%- endfor -%}
        </div>
      {%- else -%}
        <div class="sx-parallax-usp__empty">
          <p>{{ section.settings.empty_message | default: 'Add USP items in section settings' }}</p>
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

{% stylesheet %}
  .sx-parallax-usp {
    position: relative;
    padding: clamp(80px, 12vw, 140px) 0;
    color: #fff;
    overflow: hidden;
    isolation: isolate;
    min-height: 400px;
  }

  .sx-parallax-usp__background {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    background-image: var(--bg-image-url);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    filter: brightness(0.35) contrast(1.2);
    z-index: 1;
    will-change: transform;
  }

  @media screen and (max-width: 749px) {
    .sx-parallax-usp__background {
      background-attachment: scroll;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .sx-parallax-usp__background {
      background-attachment: scroll;
    }
  }

  .sx-parallax-usp__overlay {
    position: absolute;
    inset: 0;
    background: radial-gradient(
      circle at center,
      rgba(255, 106, 62, 0.15) 0%,
      rgba(0, 0, 0, 0.9) 100%
    );
    z-index: 2;
    pointer-events: none;
  }

  .sx-parallax-usp__container {
    position: relative;
    z-index: 5;
  }

  .sx-parallax-usp__content {
    max-width: 1200px;
    margin: 0 auto;
    text-align: center;
    padding: 0 20px;
  }

  @media screen and (max-width: 749px) {
    .sx-parallax-usp__content {
      padding: 0 16px;
    }
  }

  .sx-parallax-usp__headline {
    font-family: 'Montserrat Alternates', var(--font-primary--family), sans-serif;
    font-size: clamp(32px, 5vw, 56px);
    font-weight: 800;
    line-height: 1.2;
    margin: 0 0 clamp(40px, 6vw, 60px);
    text-shadow: 
      0 0 15px rgba(255, 106, 62, 0.6),
      0 0 30px rgba(255, 106, 62, 0.3),
      0 2px 4px rgba(0, 0, 0, 0.5);
    letter-spacing: 0.02em;
    color: #fff;
  }

  .sx-parallax-usp__grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--sx-grid-min-width, 260px), 1fr));
    gap: var(--sx-grid-gap, 40px);
    width: 100%;
  }

  @media screen and (max-width: 749px) {
    .sx-parallax-usp__grid {
      grid-template-columns: 1fr;
      gap: 24px;
    }
  }

  @media screen and (min-width: 750px) and (max-width: 989px) {
    .sx-parallax-usp__grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 30px;
    }
  }

  .sx-parallax-usp__card {
    background: rgba(18, 18, 18, 0.65);
    backdrop-filter: blur(16px);
    border: 1px solid rgba(47, 47, 47, 0.8);
    padding: clamp(30px, 4vw, 40px) clamp(20px, 3vw, 26px);
    border-radius: 18px;
    box-shadow: 0 0 18px rgba(0, 0, 0, 0.6);
    transition: transform 0.45s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.4s ease;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    will-change: transform;
  }

  .sx-parallax-usp__card::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    width: 8px;
    height: 100%;
    background: linear-gradient(180deg, #F15A29 0%, #FF6A3E 100%);
    opacity: 0.9;
    z-index: 1;
    transition: width 0.3s ease;
  }

  @media (prefers-reduced-motion: no-preference) {
    .sx-parallax-usp__card:hover,
    .sx-parallax-usp__card:focus-within {
      transform: translateY(-14px) scale(1.02) rotate3d(1, -1, 0, 6deg);
      box-shadow: 0 12px 35px rgba(255, 106, 62, 0.45);
    }
    
    .sx-parallax-usp__card:hover::before,
    .sx-parallax-usp__card:focus-within::before {
      width: 12px;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .sx-parallax-usp__card {
      transition: box-shadow 0.3s ease;
    }
    
    .sx-parallax-usp__card:hover,
    .sx-parallax-usp__card:focus-within {
      transform: none;
      box-shadow: 0 4px 20px rgba(255, 106, 62, 0.3);
    }
  }

  .sx-parallax-usp__card-icon-wrapper {
    margin-bottom: clamp(14px, 2vw, 18px);
    flex-shrink: 0;
  }

  .sx-parallax-usp__card-icon {
    width: clamp(48px, 6vw, 58px);
    height: auto;
    filter: drop-shadow(0 0 8px rgba(255, 106, 62, 0.6));
    transition: transform 0.3s ease, filter 0.3s ease;
    display: block;
  }

  @media (prefers-reduced-motion: no-preference) {
    .sx-parallax-usp__card:hover .sx-parallax-usp__card-icon,
    .sx-parallax-usp__card:focus-within .sx-parallax-usp__card-icon {
      transform: scale(1.1) rotate(5deg);
      filter: drop-shadow(0 0 12px rgba(255, 106, 62, 0.8));
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .sx-parallax-usp__card-icon {
      transition: none;
    }
    
    .sx-parallax-usp__card:hover .sx-parallax-usp__card-icon,
    .sx-parallax-usp__card:focus-within .sx-parallax-usp__card-icon {
      transform: none;
    }
  }

  .sx-parallax-usp__card-content {
    display: flex;
    flex-direction: column;
    gap: 12px;
    position: relative;
    z-index: 2;
    width: 100%;
  }

  .sx-parallax-usp__card-title {
    font-family: 'Montserrat Alternates', var(--font-primary--family), sans-serif;
    font-size: clamp(18px, 3vw, 22px);
    font-weight: 700;
    line-height: 1.3;
    margin: 0;
    color: #fff;
  }

  .sx-parallax-usp__card-description {
    font-family: 'Inter', var(--font-primary--family), sans-serif;
    opacity: 0.8;
    font-size: clamp(14px, 2vw, 15px);
    line-height: 1.5;
    color: rgba(255, 255, 255, 0.9);
  }

  .sx-parallax-usp__card-description p {
    margin: 0;
  }

  .sx-parallax-usp__empty {
    text-align: center;
    padding: 60px 20px;
    color: rgba(255, 255, 255, 0.7);
  }

  .sx-parallax-usp__empty p {
    margin: 0;
    font-size: 18px;
  }

  /* Focus states for accessibility */
  .sx-parallax-usp__card:focus-visible {
    outline: 2px solid #FF6A3E;
    outline-offset: 2px;
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .sx-parallax-usp__card {
      border-width: 2px;
      background: rgba(18, 18, 18, 0.95);
    }
    
    .sx-parallax-usp__card::before {
      width: 12px;
    }
    
    .sx-parallax-usp__headline {
      text-shadow: none;
    }
  }

  /* Print styles */
  @media print {
    .sx-parallax-usp__background,
    .sx-parallax-usp__overlay {
      display: none;
    }
    
    .sx-parallax-usp {
      background: #fff;
      color: #000;
    }
    
    .sx-parallax-usp__card {
      transform: none !important;
      box-shadow: none !important;
      break-inside: avoid;
      page-break-inside: avoid;
    }
  }

  /* Performance: GPU acceleration */
  .sx-parallax-usp__card {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
  }

  /* Stagger animation on load (optional, subtle) */
  @media (prefers-reduced-motion: no-preference) {
    .sx-parallax-usp__card {
      animation: sx-usp-fade-in 0.6s ease-out backwards;
    }
    
    .sx-parallax-usp__card:nth-child(1) { animation-delay: 0.1s; }
    .sx-parallax-usp__card:nth-child(2) { animation-delay: 0.2s; }
    .sx-parallax-usp__card:nth-child(3) { animation-delay: 0.3s; }
    .sx-parallax-usp__card:nth-child(4) { animation-delay: 0.4s; }
    .sx-parallax-usp__card:nth-child(5) { animation-delay: 0.5s; }
    .sx-parallax-usp__card:nth-child(6) { animation-delay: 0.6s; }
  }

  @keyframes sx-usp-fade-in {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .sx-parallax-usp__card {
      animation: none;
    }
  }

  /* Dark mode adjustments */
  @media (prefers-color-scheme: dark) {
    .sx-parallax-usp__card {
      background: rgba(18, 18, 18, 0.75);
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "SCHNAPPIX Parallax USP Section",
  "tag": "section",
  "class": "section-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Background"
    },
    {
      "type": "image_picker",
      "id": "bg_image",
      "label": "Parallax Background Image",
      "info": "Dark urban background recommended. Recommended size: 2000x1200px or larger."
    },
    {
      "type": "checkbox",
      "id": "show_overlay",
      "label": "Show Gradient Overlay",
      "default": true,
      "info": "Adds a radial gradient overlay for better text readability"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "headline",
      "label": "Section Headline",
      "default": "WHY SCHNAPPIX?"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "options": [
        {
          "value": "page-width",
          "label": "Page Width"
        },
        {
          "value": "full-width",
          "label": "Full Width"
        }
      ],
      "default": "full-width"
    },
    {
      "type": "range",
      "id": "min_card_width",
      "label": "Minimum Card Width",
      "min": 240,
      "max": 350,
      "step": 10,
      "unit": "px",
      "default": 260,
      "info": "Minimum width for each USP card"
    },
    {
      "type": "range",
      "id": "grid_gap",
      "label": "Grid Gap",
      "min": 20,
      "max": 60,
      "step": 5,
      "unit": "px",
      "default": 40
    },
    {
      "type": "text",
      "id": "empty_message",
      "label": "Empty State Message",
      "default": "Add USP items in section settings",
      "info": "Message shown when no USP items are added"
    },
    {
      "type": "header",
      "content": "Appearance"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    }
  ],
  "blocks": [
    {
      "type": "usp",
      "name": "USP Item",
      "limit": 6,
      "settings": [
        {
          "type": "image_picker",
          "id": "icon",
          "label": "USP Icon",
          "info": "Recommended size: 120x120px. Square icons work best."
        },
        {
          "type": "text",
          "id": "title",
          "label": "USP Title",
          "default": "USP Title"
        },
        {
          "type": "textarea",
          "id": "desc",
          "label": "USP Description",
          "default": "USP description text goes here."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "SCHNAPPIX Parallax USP Section",
      "category": "Custom",
      "blocks": [
        {
          "type": "usp",
          "settings": {
            "title": "Premium Quality",
            "desc": "Only the finest ingredients and products."
          }
        },
        {
          "type": "usp",
          "settings": {
            "title": "Fast Delivery",
            "desc": "Quick shipping to your door."
          }
        },
        {
          "type": "usp",
          "settings": {
            "title": "24/7 Support",
            "desc": "We're here whenever you need us."
          }
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}

