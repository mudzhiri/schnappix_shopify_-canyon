{%- comment -%}
  SCHNAPPIX Parallax Products Section
  A customizable product showcase section with parallax background effect
  Optimized for performance, accessibility, and responsive design
{%- endcomment -%}

{%- liquid
  assign section_id = 'SchnappixParallaxProducts-' | append: section.id
  assign blocks_count = section.blocks.size
  assign has_products = false
  
  if blocks_count > 0
    assign has_products = true
  endif
  
  assign bg_image_url = section.settings.bg | image_url: width: 1920
  assign min_card_width = section.settings.min_card_width | default: 250
  assign grid_gap = section.settings.grid_gap | default: 24
-%}

<section
  id="{{ section_id }}"
  class="sx-parallax-products color-{{ section.settings.color_scheme }}"
  data-section-id="{{ section.id }}"
  {% if section.settings.bg != blank %}
    style="background-image: url({{ bg_image_url }});"
  {% endif %}
  {% if request.visual_preview_mode %}
    data-shopify-visual-preview
  {% endif %}
>
  <div class="sx-parallax-products__container section section--{{ section.settings.section_width }}">
    {%- if section.settings.headline != blank -%}
      <div class="sx-parallax-products__headline">
        <div class="sx-parallax-products__headline-content">
          {{ section.settings.headline }}
        </div>
      </div>
    {%- endif -%}

    {%- if has_products -%}
      <div
        class="sx-parallax-products__grid"
        style="
          --sx-grid-min-width: {{ min_card_width }}px;
          --sx-grid-gap: {{ grid_gap }}px;
          --sx-grid-columns: {{ section.settings.columns_desktop | default: 'auto-fit' }};
        "
        data-product-count="{{ blocks_count }}"
      >
        {%- for block in section.blocks -%}
          {%- assign product = block.settings.product -%}
          {%- if product != blank -%}
            <div
              class="sx-parallax-products__card"
              {{ block.shopify_attributes }}
              data-block-id="{{ block.id }}"
              data-product-id="{{ product.id }}"
            >
              {%- if product.featured_media -%}
                <div class="sx-parallax-products__card-image-wrapper">
                  <a
                    href="{{ product.url }}"
                    class="sx-parallax-products__card-link"
                    aria-label="{{ product.title | escape }}"
                  >
                    {{
                      product.featured_media
                      | image_url: width: 500
                      | image_tag:
                        loading: 'lazy',
                        width: product.featured_media.width,
                        height: product.featured_media.height,
                        alt: product.featured_media.alt | default: product.title | escape,
                        class: 'sx-parallax-products__card-image',
                        sizes: '(min-width: 750px) 33vw, 50vw'
                    }}
                  </a>
                </div>
              {%- endif -%}
              
              <div class="sx-parallax-products__card-content">
                <h3 class="sx-parallax-products__card-title">
                  <a href="{{ product.url }}" class="sx-parallax-products__card-title-link">
                    {{ product.title }}
                  </a>
                </h3>
                
                {%- if section.settings.show_vendor and product.vendor != blank -%}
                  <p class="sx-parallax-products__card-vendor">{{ product.vendor }}</p>
                {%- endif -%}
                
                {%- if section.settings.show_price -%}
                  <div class="sx-parallax-products__card-price">
                    {%- render 'price', product_resource: product -%}
                  </div>
                {%- endif -%}
                
                {%- if section.settings.show_quick_add and product.available -%}
                  <div class="sx-parallax-products__card-actions">
                    {%- render 'variant-quick-add', product_resource: product -%}
                  </div>
                {%- endif -%}
              </div>
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- else -%}
      <div class="sx-parallax-products__empty">
        <p>{{ section.settings.empty_message | default: 'No products available' }}</p>
      </div>
    {%- endif -%}
  </div>
</section>

{% stylesheet %}
  .sx-parallax-products {
    position: relative;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    padding: clamp(40px, 8vw, 80px) 0;
    min-height: 400px;
    overflow: hidden;
  }

  @media screen and (max-width: 749px) {
    .sx-parallax-products {
      background-attachment: scroll;
      padding: clamp(30px, 6vw, 60px) 0;
      min-height: 300px;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .sx-parallax-products {
      background-attachment: scroll;
    }
  }

  .sx-parallax-products__container {
    position: relative;
    z-index: 2;
  }

  .sx-parallax-products__headline {
    text-align: center;
    margin-bottom: clamp(30px, 5vw, 40px);
    padding: 0 20px;
  }

  .sx-parallax-products__headline-content {
    color: rgb(var(--color-foreground));
    max-width: 1200px;
    margin: 0 auto;
  }

  .sx-parallax-products__headline-content h2,
  .sx-parallax-products__headline-content h3 {
    margin: 0;
    font-size: clamp(24px, 4vw, 36px);
    font-weight: 700;
    line-height: 1.3;
  }

  .sx-parallax-products__grid {
    max-width: 1300px;
    margin: 0 auto;
    padding: 0 20px;
    display: grid;
    grid-template-columns: repeat(var(--sx-grid-columns, auto-fit), minmax(var(--sx-grid-min-width, 250px), 1fr));
    gap: var(--sx-grid-gap, 24px);
    width: 100%;
  }

  @media screen and (max-width: 749px) {
    .sx-parallax-products__grid {
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      padding: 0 16px;
    }
  }

  @media screen and (min-width: 750px) and (max-width: 989px) {
    .sx-parallax-products__grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .sx-parallax-products__card {
    background: rgba(30, 30, 30, 0.95);
    backdrop-filter: blur(10px);
    padding: 20px;
    border: 1px solid rgba(47, 47, 47, 0.8);
    border-radius: 14px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
    overflow: hidden;
  }

  .sx-parallax-products__card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255, 106, 62, 0.1) 0%, transparent 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 1;
  }

  .sx-parallax-products__card:hover,
  .sx-parallax-products__card:focus-within {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(255, 106, 62, 0.4);
    border-color: rgba(255, 106, 62, 0.6);
  }

  .sx-parallax-products__card:hover::before,
  .sx-parallax-products__card:focus-within::before {
    opacity: 1;
  }

  @media (prefers-reduced-motion: reduce) {
    .sx-parallax-products__card {
      transition: none;
    }
    
    .sx-parallax-products__card:hover,
    .sx-parallax-products__card:focus-within {
      transform: none;
    }
  }

  .sx-parallax-products__card-image-wrapper {
    position: relative;
    width: 100%;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    border-radius: 10px;
    margin-bottom: 16px;
    background: rgba(255, 255, 255, 0.05);
  }

  .sx-parallax-products__card-link {
    display: block;
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
  }

  .sx-parallax-products__card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: block;
  }

  .sx-parallax-products__card:hover .sx-parallax-products__card-image,
  .sx-parallax-products__card:focus-within .sx-parallax-products__card-image {
    transform: scale(1.05);
  }

  @media (prefers-reduced-motion: reduce) {
    .sx-parallax-products__card-image {
      transition: none;
    }
    
    .sx-parallax-products__card:hover .sx-parallax-products__card-image,
    .sx-parallax-products__card:focus-within .sx-parallax-products__card-image {
      transform: none;
    }
  }

  .sx-parallax-products__card-content {
    display: flex;
    flex-direction: column;
    flex: 1;
    gap: 8px;
    position: relative;
    z-index: 2;
  }

  .sx-parallax-products__card-title {
    margin: 0;
    font-size: clamp(16px, 2vw, 18px);
    font-weight: 600;
    line-height: 1.4;
  }

  .sx-parallax-products__card-title-link {
    color: rgb(var(--color-foreground));
    text-decoration: none;
    transition: color 0.2s ease;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .sx-parallax-products__card-title-link:hover,
  .sx-parallax-products__card-title-link:focus {
    color: #FF6A3E;
    outline: none;
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .sx-parallax-products__card-vendor {
    margin: 0;
    font-size: 14px;
    color: rgba(var(--color-foreground), 0.7);
    font-weight: 400;
  }

  .sx-parallax-products__card-price {
    margin-top: auto;
    font-size: clamp(16px, 2vw, 18px);
    font-weight: 600;
    color: rgb(var(--color-foreground));
  }

  .sx-parallax-products__card-actions {
    margin-top: 12px;
  }

  .sx-parallax-products__empty {
    text-align: center;
    padding: 60px 20px;
    color: rgb(var(--color-foreground));
  }

  .sx-parallax-products__empty p {
    margin: 0;
    font-size: 18px;
    opacity: 0.8;
  }

  /* Loading state */
  .sx-parallax-products__card[data-loading="true"] {
    opacity: 0.6;
    pointer-events: none;
  }

  /* Focus visible for better accessibility */
  .sx-parallax-products__card:focus-visible {
    outline: 2px solid #FF6A3E;
    outline-offset: 2px;
  }

  /* Print styles */
  @media print {
    .sx-parallax-products {
      background-attachment: scroll;
      background-image: none !important;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "SCHNAPPIX Parallax Products",
  "tag": "section",
  "class": "section-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Background"
    },
    {
      "type": "image_picker",
      "id": "bg",
      "label": "Background Image",
      "info": "Recommended size: 1920x1080px or larger. For best performance, use optimized images."
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "richtext",
      "id": "headline",
      "label": "Headline",
      "default": "<h2>Trending Snacks & Drinks</h2>"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "options": [
        {
          "value": "page-width",
          "label": "Page Width"
        },
        {
          "value": "full-width",
          "label": "Full Width"
        }
      ],
      "default": "full-width"
    },
    {
      "type": "range",
      "id": "min_card_width",
      "label": "Minimum Card Width",
      "min": 200,
      "max": 400,
      "step": 10,
      "unit": "px",
      "default": 250,
      "info": "Minimum width for each product card"
    },
    {
      "type": "range",
      "id": "grid_gap",
      "label": "Grid Gap",
      "min": 12,
      "max": 48,
      "step": 4,
      "unit": "px",
      "default": 24
    },
    {
      "type": "select",
      "id": "columns_desktop",
      "label": "Desktop Columns",
      "options": [
        {
          "value": "auto-fit",
          "label": "Auto Fit"
        },
        {
          "value": "2",
          "label": "2 Columns"
        },
        {
          "value": "3",
          "label": "3 Columns"
        },
        {
          "value": "4",
          "label": "4 Columns"
        }
      ],
      "default": "auto-fit",
      "info": "Number of columns on desktop (tablet: 2, mobile: auto)"
    },
    {
      "type": "header",
      "content": "Product Display"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_price",
      "label": "Show Price",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_quick_add",
      "label": "Show Quick Add Button",
      "default": false,
      "info": "Requires quick add feature to be enabled in theme settings"
    },
    {
      "type": "text",
      "id": "empty_message",
      "label": "Empty State Message",
      "default": "No products available",
      "info": "Message shown when no products are added"
    },
    {
      "type": "header",
      "content": "Appearance"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product Item",
      "limit": 20,
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "SCHNAPPIX Parallax Products",
      "category": "Custom",
      "blocks": [
        {
          "type": "product"
        },
        {
          "type": "product"
        },
        {
          "type": "product"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}

